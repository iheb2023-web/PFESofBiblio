<main>
    <section class="vh-xxl-100">
      <div class="container h-100 d-flex px-0 px-sm-4">
        <div class="row justify-content-center align-items-center m-auto">
          <div class="col-12">
            <div class="bg-mode shadow rounded-3 overflow-hidden">
              <div class="row g-0">
                <!-- Vector Image -->
                <div class="col-lg-6 d-md-flex align-items-center order-2 order-lg-1">
                  <div class="p-3 p-lg-5">
                    <img src="assets/images/element/forgot-pass.svg" alt="">
                  </div>
                  <div class="vr opacity-1 d-none d-lg-block"></div>
                </div>
  
                <!-- Information -->
                <div class="col-lg-6 order-1">
                  <div class="p-4 p-sm-7">
                    <!-- Logo -->
                    <a href="index.html">
                      <img class="mb-4 h-50px" src="assets/images/logo-icon.svg" alt="logo">
                    </a>
  
                    <!-- Conditional Rendering -->
                    <ng-container *ngIf="!code && !newPassword; else formTemplate">
                      <!-- Forgot Password Form -->
                      <h1 class="mb-2 h3">Forgot password?</h1>
                      <p class="mb-sm-0">Enter the email address associated with an account.</p>
                      <div *ngIf="errorMessage" class="alert alert-danger mt-3">
                        {{ errorMessage }}
                      </div>
                      <!-- Form START -->
                      <form class="mt-sm-4 text-start" (ngSubmit)="resetPassword()" #loginForm="ngForm">
                        <!-- Email -->
                        <div class="mb-3">
                          <label class="form-label">Enter email</label>
                          <input 
                            type="email" 
                            class="form-control" 
                            required 
                            [(ngModel)]="email" 
                            name="email" 
                            #emailInput="ngModel"
                            [ngClass]="{'is-invalid': emailInput.invalid && emailInput.touched}"
                            pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$"
                          >
                          <div *ngIf="emailInput.touched && emailInput.invalid" class="invalid-feedback">
                            <span *ngIf="emailInput.errors?.['required']">Email is required.</span>
                            <span *ngIf="emailInput.errors?.['pattern']">Enter a valid email address.</span>
                          </div>
                        </div>
  
                        <div class="mb-3 text-center">
                          <p>Back to <a [routerLink]="['/login']">Sign in</a></p>
                        </div>
  
                        <!-- Button -->
                        <div class="d-grid">
                          <button type="submit" class="btn btn-primary w-100 mb-0" [disabled]="loginForm.invalid">Reset Password</button>
                        </div>
                      </form>
                      <!-- Form END -->
                    </ng-container>
  
                    <!-- Form Template -->
                    <ng-template #formTemplate>
                      <!-- Verification Code Form -->
                      <ng-container *ngIf="code">
                        <h1 class="mb-2 h3">Verify Code</h1>
                        <p class="mb-sm-0">We have sent a code to <b>{{email}}</b></p>
                        <div *ngIf="errorMessage" class="alert alert-danger mt-3">
                          {{ errorMessage }}
                        </div>
                        <!-- Form START -->
                        <form class="mt-sm-4" (ngSubmit)="verifyCode()" #verifyForm="ngForm">
                          <!-- Input box -->
                          <p class="mb-1">Enter the code we have sent you:</p>
                          <div class="autotab d-flex justify-content-between gap-1 gap-sm-3 mb-2">
                            <input 
                              type="text" 
                              maxlength="1" 
                              class="form-control text-center p-3"
                              [(ngModel)]="verificationCode[0]"
                              name="code1"
                              autotab-index="0"
                              (input)="onCodeInput($event, 0)"
                              required
                            >
                            <input 
                              type="text" 
                              maxlength="1" 
                              class="form-control text-center p-3"
                              [(ngModel)]="verificationCode[1]"
                              name="code2"
                              autotab-index="1"
                              (input)="onCodeInput($event, 1)"
                              required
                            >
                            <input 
                              type="text" 
                              maxlength="1" 
                              class="form-control text-center p-3"
                              [(ngModel)]="verificationCode[2]"
                              name="code3"
                              autotab-index="2"
                              (input)="onCodeInput($event, 2)"
                              required
                            >
                            <input 
                              type="text" 
                              maxlength="1" 
                              class="form-control text-center p-3"
                              [(ngModel)]="verificationCode[3]"
                              name="code4"
                              autotab-index="3"
                              (input)="onCodeInput($event, 3)"
                              required
                            >
                          </div>
  
                          <!-- Button link -->
                          <div class="d-sm-flex justify-content-between small mb-4">
                            <span>Don't get a code?</span>
                            <a href="#" (click)="resendCode()" class="btn btn-sm btn-link p-0 text-decoration-underline mb-0">Click to resend</a>
                          </div>
  
                          <!-- Button -->
                          <div class="d-grid">
                            <button type="submit" class="btn btn-primary w-100 mb-0" [disabled]="verifyForm.invalid">Verify and Process</button>
                          </div>
                        </form>
                        <!-- Form END -->
                      </ng-container>
  
                      <!-- New Password Form -->
                      <ng-container *ngIf="newPassword">
                        <h1 class="mb-2 h3">Set New Password</h1>
                        <p class="mb-sm-0">Enter your new password below.</p>
                        <div *ngIf="errorMessage" class="alert alert-danger mt-3">
                          {{ errorMessage }}
                        </div>
                        <!-- Form START -->
                        <form class="mt-sm-4 text-start" (ngSubmit)="setNewPassword()" #newPasswordForm="ngForm">
                          <!-- New Password -->
                          <div class="mb-3">
                            <label class="form-label">New Password</label>
                            <input 
                              type="password" 
                              class="form-control" 
                              required 
                              [(ngModel)]="newPasswordRequest.newPassword" 
                              name="newPassword" 
                              #newPassword="ngModel"
                              [ngClass]="{'is-invalid': newPassword.invalid && newPassword.touched}"
                              minlength="8"
                            >
                            <div *ngIf="newPassword.touched && newPassword.invalid" class="invalid-feedback">
                              <span *ngIf="newPassword.errors?.['required']">New Password is required.</span>
                              <span *ngIf="newPassword.errors?.['minlength']">Password must be at least 8 characters long.</span>
                            </div>
                          </div>
  
                          <!-- Confirm Password -->
                          <div class="mb-3">
                            <label class="form-label">Confirm Password</label>
                            <input 
                              type="password" 
                              class="form-control" 
                              required 
                              [(ngModel)]="newPasswordRequest.confirmPassword" 
                              name="confirmPassword" 
                              #confirmPassword="ngModel"
                              [ngClass]="{'is-invalid': confirmPassword.invalid && confirmPassword.touched}"
                            >
                            <div *ngIf="confirmPassword.touched && confirmPassword.invalid" class="invalid-feedback">
                              <span *ngIf="confirmPassword.errors?.['required']">Confirm Password is required.</span>
                            </div>
                            <div *ngIf="newPasswordRequest.newPassword !== newPasswordRequest.confirmPassword && confirmPassword.touched" class="text-danger">
                              Passwords do not match.
                            </div>
                          </div>
  
                          <!-- Button -->
                          <div class="d-grid">
                            <button 
                              type="submit" 
                              class="btn btn-primary w-100 mb-0" 
                              [disabled]="newPasswordForm.invalid || newPasswordRequest.newPassword !== newPasswordRequest.confirmPassword"
                            >
                              Set New Password
                            </button>
                          </div>
                        </form>
                        <!-- Form END -->
                      </ng-container>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
  
  <!-- Back to top -->
  <div class="back-top"></div>